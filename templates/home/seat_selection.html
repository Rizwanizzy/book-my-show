{% extends 'base2.html' %}
{% load static%}
{% block booking%}
<div class="content">
	<div class="main">
		<h2>{{theatres.theatre}}  {{theatres}}</h2>
		<div class="demo">
			<div id="seat-map">
				<div class="front">SCREEN</div>					
			</div>
			<br><br>
			<div id="legend"></div>
			<div class="booking-details" style="width:75%">
				<ul class="book-left">
					<li>Movie </li>
					<li>Time </li>
					<li>Tickets</li>
					<li>Total</li>
					<li>Seats :</li>
				</ul>
				<ul class="book-right">
					<li>: {{theatres.movies.title}}</li>
					<li>: {{times}}  {{selected_date}}</li>
					<li>: <span id="counter">0</span></li>
					<li>: <b><i>â‚¹</i><span id="total"></span></b></li>
				</ul>
				<div class="clear"></div>
				<ul id="selected-seats" class="" style="display:flex;width:100%"></ul>
			
						
				<a href="{% url 'payment' %}" ><button class="checkout-button">Book Now</button>	<a/>
				
			</div>
			<div style="clear:both"></div>
	    </div>
		

			<script type="text/javascript">
				var price = {{theatres.price1}}; //price
				var rows = Number("{{ rows }}");
				var columns = Number("{{ columns }}");
				var unavailableSeats = {{ unavailable_seats|safe }};
				console.log(unavailableSeats)
				$(document).ready(function() {
					var $cart = $('#selected-seats'), //Sitting Area
					$counter = $('#counter'), //Votes
					$total = $('#total'); //Total money
					
					var seatingChart = [];

					for (var row = 1; row <= rows; row++) {
						var rowArr = '';
						for (var col = 1; col <= columns; col++) {
							
								rowArr += 'a';// Available seat
							
						}
						seatingChart.push(rowArr);
					}

					var sc = $('#seat-map').seatCharts({
						map: seatingChart,
						naming : {
							top : false,
							getLabel : function (character, row, column) {
								return column;
							}
						},
						legend : { //Definition legend
							node : $('#legend'),
							items : [
								[ 'a', 'available',   'Available' ],
								[ 'u', 'unavailable', 'Sold'],
								[ 'a', 'selected', 'Selected']
							]					
						},
						click: function () { //Click event
							if (this.status() == 'available') { //optional seat
								$('<li>Row'+(this.settings.row+1)+' Seat'+this.settings.label+'</li>')
									.attr('id', 'cart-item-'+this.settings.id)
									.data('seatId', this.settings.id)
									.appendTo($cart);

								$counter.text(sc.find('selected').length+1);
								$total.text(recalculateTotal(sc)+price);
											
								return 'selected';
							} else if (this.status() == 'selected') { //Checked
									//Update Number
									$counter.text(sc.find('selected').length-1);
									//update totalnum
									$total.text(recalculateTotal(sc)-price);
										
									//Delete reservation
									$('#cart-item-'+this.settings.id).remove();
									//optional
									return 'available';
							} else if (this.status() == 'unavailable') { //sold
								return 'unavailable';
							} else {
								return this.style();
							}
						}
					});
					//sold seat
					sc.get(unavailableSeats).status('unavailable');
						
				});
				//sum total money
				function recalculateTotal(sc) {
					var total = 0;
					sc.find('selected').each(function () {
						total += price;
					});
							
					return total;
				}
			</script>
	</div>
	
</div>
<script src="{% static 'js2/jquery.nicescroll.js' %}"></script>
<script src="{% static 'js2/scripts.js' %}"></script>

{% endblock %}